---
/* We don't need any server-side fetching here, so the frontmatter can be left empty */
---

<main id="card-container">
  <p>Loading cards...</p> <!-- Placeholder message while the data is being fetched -->
</main>

<script>
  async function fetchNotionData() {
    const notionApiUrl = '/.netlify/functions/fetch-notion';

    try {
      const response = await fetch(notionApiUrl);
      const contentType = response.headers.get('content-type');
      if (contentType && contentType.includes('text/html')) {
        console.error('Received HTML response instead of JSON');
        throw new Error('Server returned an HTML response instead of JSON');
      }

      const localNotionData = await response.json();
      const localCards = localNotionData.results; // Array of objects

      // Populate the card container with the fetched data
      const cardContainer = document.getElementById('card-container');
      // @ts-ignore
      cardContainer.innerHTML = ''; // Clear the loading message

      localCards.forEach((card: any) => {
        const article = document.createElement('article');
        article.classList.add('card');

        article.innerHTML = `
          <div class="img__container">
            <img src="/images/notion-post-image.webp" class="card__image" />
          </div>
          <h2 class="card__heading">${card.properties.Title.rich_text[0]?.plain_text}</h2>
          <div class="card__content">
            <p class="card__description">${card.properties.Description.rich_text[0]?.plain_text}</p>
          </div>
          <a href="#">
            <div class="card__btn">READ POST</div>
          </a>
        `;
      // @ts-ignore
        cardContainer.appendChild(article);
      });
    } catch (error: any) {
      console.error('Error fetching data:', error.message);
      const cardContainer = document.getElementById('card-container');
      // @ts-ignore
      cardContainer.innerHTML = '<p>Failed to load cards. Please try again later.</p>';
    }
  }

  fetchNotionData();
</script>